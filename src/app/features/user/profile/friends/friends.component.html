<div class="px-6 py-4 rounded-lg overflow-hidden bg-white">
  <!-- Tabs trên đầu -->
  <div class="flex items-center justify-between mb-4">
    <!-- header -->
    <span class="text-black font-bold text-2xl">Bạn bè</span>
    
    <!-- Các ô tìm kiếm -->
    <div class="flex gap-2">
      <!-- Ô tìm kiếm bạn bè -->
      <div class="relative w-full">
        <i class="fa-solid fa-magnifying-glass text-blue-500 absolute left-3 top-1/2 -translate-y-1/2"></i>
        <input 
          type="text" 
          placeholder="Tìm kiếm" 
          class="bg-gray-100 rounded-lg py-2 px-4 pl-10 w-full focus:outline-none"
        >
      </div>

      <!-- Các lời mời kết bạn -->
      <button
        class="flex items-center gap-2 px-4 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 border border-gray-300 font-medium transition whitespace-nowrap"
      >
        <i class="fa-solid fa-user-plus text-blue-500"></i>
        Lời mời kết bạn
      </button>

      <!-- Tìm thêm bạn bè -->
      <button
        class="flex items-center gap-2 px-4 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 border border-gray-300 font-medium transition whitespace-nowrap"
      >
        Tìm bạn bè
      </button>
    </div>

  </div>


  <div class="flex gap-6 border-b pb-2 mb-4">
    <button
      class="pb-2 font-medium"
      [ngClass]="activeTab === 'all' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600'"
      (click)="changeTab('all')"
    >
      Tất cả bạn bè
    </button>
    <button
      *ngIf="currentUserLoggedIn?.profile?.username === currentUsername"
      class="pb-2 font-medium"
      [ngClass]="activeTab === 'followers' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600'"
      (click)="changeTab('followers')"
    >
      Người theo dõi
    </button>
    <button
      class="pb-2 font-medium"
      [ngClass]="activeTab === 'followings' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600'"
      (click)="changeTab('followings')"
    >
      Đang theo dõi
    </button>
  </div>

  <!-- Tất cả bạn bè -->
  <div 
    *ngIf="activeTab === 'all'"
    infinite-scroll
    [infiniteScrollDistance]="2"
    [infiniteScrollThrottle]="300"
    (scrolled)="loadMore()"
    [scrollWindow]="true"
  >
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
      <div
        *ngFor="let friend of friends; let i = index"
        class="flex items-center justify-between bg-white rounded-lg shadow-sm hover:shadow-md transition relative p-3"
      >
        <div class="flex items-center gap-3">
          <a [routerLink]="['/user/profile', friend.otherUser?.profile?.username]">
            <app-avatar
              [avatarUrl]="friend.otherUser?.profile?.avatarUrl"
              [width]="64"
              [height]="64"
              [customClass]="'rounded-lg object-cover'"
            ></app-avatar>
          </a>
          <div>
            <a
              [routerLink]="['/user/profile', friend.otherUser?.profile?.username]"
              class="font-medium hover:underline"
            >
              {{ friend.otherUser?.profile?.fullName || friend.otherUser?.profile?.username }}
            </a>
          </div>
        </div>

        <!-- Nút menu -->
        <button
          class="p-2 rounded-full hover:bg-gray-100 transition relative"
          (click)="toggleMenu(i)"
        >
          <i class="fa-solid fa-ellipsis text-lg text-gray-500"></i>
        </button>

        <!-- Dropdown -->
        <div
          *ngIf="openMenuIndex === i"
          class="absolute right-3 top-16 bg-white border border-gray-200 rounded-xl shadow-lg w-44 z-50"
        >
          <ul class="py-2">
            <li
              class="flex items-center gap-2 px-4 py-2 hover:bg-red-50 hover:text-red-700 cursor-pointer text-red-600 rounded-lg transition"
              (click)="removeFriend(friend)"
            >
              <i class="fa-solid fa-user-xmark"></i>
              <span>Xóa bạn bè</span>
            </li>
          </ul>
        </div>
      </div>
      <p *ngIf="friends.length === 0" class="text-gray-500 text-lg">Chưa có bạn bè</p>
    </div>
  </div>

  <!-- Người theo dõi -->
  <div *ngIf="activeTab === 'followers'">
    <div *ngIf="friendRequests.length > 0; else noRequest">
      <div
        *ngFor="let req of friendRequests"
        class="flex items-center justify-between bg-white rounded-lg shadow-sm p-3 mb-2"
      >
        <div class="flex items-center gap-3">
          <app-avatar
            [avatarUrl]="req.sender?.profile?.avatarUrl"
            [width]="48"
            [height]="48"
            [customClass]="'rounded-lg object-cover'"
          ></app-avatar>
          <span>{{ req.sender?.profile?.fullName || req.sender?.username }}</span>
        </div>
        <div class="flex gap-2">
          <button
            class="px-3 py-1 rounded-lg bg-blue-500 text-white hover:bg-blue-600"
            (click)="acceptRequest(req)"
          >
            Chấp nhận
          </button>
          <button
            class="px-3 py-1 rounded-lg bg-gray-200 hover:bg-gray-300"
            (click)="declineRequest(req)"
          >
            Từ chối
          </button>
        </div>
      </div>
    </div>
    <ng-template #noRequest>
      <p class="text-gray-500">Không có người theo dõi nào.</p>
    </ng-template>
  </div>

  <!-- Tìm kiếm bạn bè -->
  <div *ngIf="activeTab === 'followings'">
    <div *ngIf="searchResults.length > 0; else noResult">
      <div
        *ngFor="let user of searchResults"
        class="flex items-center justify-between bg-white rounded-lg shadow-sm p-3 mb-2"
      >
        <div class="flex items-center gap-3">
          <app-avatar
            [avatarUrl]="user.profile?.avatarUrl"
            [width]="48"
            [height]="48"
            [customClass]="'rounded-lg object-cover'"
          ></app-avatar>
          <span>{{ user.profile?.fullName || user.username }}</span>
        </div>
        <button
          class="px-3 py-1 rounded-lg bg-blue-500 text-white hover:bg-blue-600"
          (click)="sendFriendRequest(user)"
        >
          Thêm bạn bè
        </button>
      </div>
    </div>
    <ng-template #noResult>
      <p class="text-gray-500">Không tìm thấy kết quả nào.</p>
    </ng-template>
  </div>
</div>
