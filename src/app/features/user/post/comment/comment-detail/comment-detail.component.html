<div class="flex items-start gap-2" >
  <!-- avatar -->
  <div class="w-8 h-8 flex-shrink-0">
    <app-avatar
      [avatarUrl]="comment.author.profile.avatarUrl"
      [width]="32"
      [height]="32"
      [customClass]="'rounded-full'"
    ></app-avatar>
  </div>

  <!-- nội dung -->
  <div class="flex-1" >
    <div [id]="'comment-' + comment.id"
       class="bg-gray-100 px-3 py-2 rounded-2xl inline-block max-w-[500px]">
      <!-- header -->
      <div class="flex items-center gap-2">
        <p
          routerLink="/user/profile/{{ comment.author.profile.username }}"
          class="font-semibold text-sm cursor-pointer hover:underline"
        >
          {{ comment.author.profile.fullName }}
        </p>
      </div>
  
      <!-- bubble -->
      <p class="text-sm break-words break-all whitespace-pre-line" 
        [innerHTML]="comment.content | mentionHighlight"
      ></p>
    </div>
    

    <!-- actions -->
    <div class="flex items-center gap-4 text-xs py-1 text-gray-600">
      <span class="text-xs pl-3 text-gray-500">
        {{ comment.createdAt | timeAgo }}
      </span>
      <button (click)="toggleLike()" class="flex items-center">
        <i class="fa" [ngClass]="isLiked ? 'fas fa-thumbs-up text-blue-500' : 'fa-regular fa-thumbs-up'"></i>
        <span class="hover:underline">{{ totalLikes != 0 ? totalLikes : 'Thích' }}</span>
      </button>

      <!-- nút phản hồi -->
      <button (click)="toggleReplyBox()" class="text-gray-600 hover:underline">
        Phản hồi
      </button>
    </div>

    <!-- link xem replies -->
    @if (comment.repliesCount > 0 && !repliesLoaded) {
      <div class="ml-8 mb-2 text-sm text-gray-600 cursor-pointer hover:underline"
        (click)="loadReplies()">
        Xem {{ comment.repliesCount }} phản hồi
      </div>
    }

    <!-- ô nhập phản hồi -->
    @if (showReplyBox) {
      <div class="mt-2 flex items-start gap-2">
        <app-avatar
          [avatarUrl]="currentUser?.profile?.avatarUrl"
          [width]="28"
          [height]="28"
          [customClass]="'rounded-full'"
        ></app-avatar>
  
        <div class="flex-1 flex gap-2">
          <input
            [(ngModel)]="replyContent"
            (keyup.enter)="submitReply()"
            type="text"
            placeholder="Viết phản hồi..."
            class="w-full border rounded-full px-3 py-1 text-sm focus:outline-none focus:ring-1 focus:ring-blue-400"
          />
          <button (click)="submitReply()" class="text-blue-500 font-semibold px-2">
            Gửi
          </button>
        </div>
      </div>
    }

    <!-- hiển thị replies -->
    @if (repliesLoaded) {
      <div class="mt-2">
        @for (reply of replies; track $index) {
          <app-comment-detail
            [comment]="reply"
            [currentUser]="currentUser"
            [highlightCommentId]="highlightCommentId"
          ></app-comment-detail>
        }
      </div>
    } 
  </div>
</div>